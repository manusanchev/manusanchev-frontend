---
const duration = 5000
const interval = 150
const symbol = '❄'
---

<div 
  id="snow-container" 
  class="fixed inset-0 z-50 pointer-events-none overflow-hidden"
  aria-hidden="true"
  data-duration={duration}
  data-interval={interval}
  data-symbol={symbol}
></div>

<script>
  const container = document.getElementById('snow-container')
  
  if (container) {
    const duration = Number(container.dataset.duration)
    const interval = Number(container.dataset.interval)
    const symbol = container.dataset.symbol ?? '❄'
    
    let isActive = true
    let intervalId: ReturnType<typeof setInterval> | null = null

    const createSnowflake = () => {
      if (!isActive) {
        return
      }

      const snowflake = document.createElement('span')
      snowflake.textContent = symbol
      snowflake.className = 'snowflake absolute text-stone-600 dark:text-white opacity-80'
      
      const left = Math.random() * 100
      const size = Math.random() * 1.5 + 0.8
      const fallDuration = Math.random() * 4 + 4
      const drift = (Math.random() - 0.5) * 100

      snowflake.style.cssText = `
        left: ${left}%;
        font-size: ${size}rem;
        --fall-duration: ${fallDuration}s;
        --drift: ${drift}px;
      `

      container.appendChild(snowflake)

      setTimeout(() => {
        snowflake.remove()
      }, fallDuration * 1000)
    }

    const stop = () => {
      isActive = false
      if (intervalId) {
        clearInterval(intervalId)
        intervalId = null
      }
    }

    intervalId = setInterval(createSnowflake, interval)
    setTimeout(stop, duration)

    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        stop()
      }
    }, { once: true })
  }
</script>

<style is:global>
  @keyframes snowfall {
    0% {
      transform: translateY(-5vh) translateX(0);
      opacity: 0;
    }
    10% {
      opacity: 0.8;
    }
    90% {
      opacity: 0.8;
    }
    100% {
      transform: translateY(105vh) translateX(var(--drift));
      opacity: 0;
    }
  }

  .snowflake {
    top: 0;
    animation: snowfall var(--fall-duration) linear forwards;
    will-change: transform;
  }
</style>
